<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>quad_refinement &mdash; PyHexSpline 0.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/documentation_options.js?v=938c9ccc"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            PyHexSpline
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hr_pqct_meshing.html">HR-pQCT Structured Hexahedral Meshing</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PyHexSpline</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">quad_refinement</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for quad_refinement</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Quad refinement scheme for the inner trabecular region</span>
<span class="sd">Author: Simone Poncioni, MSB</span>
<span class="sd">Date: 04.2023</span>

<span class="sd">https://stackoverflow.com/questions/31527755/extract-blocks-or-patches-from-numpy-array</span>
<span class="sd">https://blender.stackexchange.com/questions/230534/fastest-way-to-skin-a-grid</span>
<span class="sd">https://gitlab.onelab.info/gmsh/gmsh/-/issues/1710</span>
<span class="sd">https://gitlab.onelab.info/gmsh/gmsh/-/issues/2439</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>

<span class="kn">import</span> <span class="nn">cv2</span>
<span class="kn">import</span> <span class="nn">gmsh</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">cython_functions</span> <span class="kn">import</span> <span class="n">find_closed_curve</span> <span class="k">as</span> <span class="n">fcc</span>
<span class="kn">from</span> <span class="nn">skimage.util</span> <span class="kn">import</span> <span class="n">view_as_windows</span>

<span class="n">LOGGING_NAME</span> <span class="o">=</span> <span class="s2">&quot;MESHING&quot;</span>
<span class="c1"># flake8: noqa: E402</span>


<div class="viewcode-block" id="QuadRefinement">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement">[docs]</a>
<span class="k">class</span> <span class="nc">QuadRefinement</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">nb_layers</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">DIM</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">SQUARE_SIZE_0_MM</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">MAX_SUBDIVISIONS</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">ELMS_THICKNESS</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nb_layers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nb_layers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DIM</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">DIM</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">occ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EDGE_LENGTH</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SHOW_PLOT</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">LOGGING_NAME</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SQUARE_SIZE_0_MM</span> <span class="o">=</span> <span class="n">SQUARE_SIZE_0_MM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MAX_SUBDIVISIONS</span> <span class="o">=</span> <span class="n">MAX_SUBDIVISIONS</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elms_thickness</span> <span class="o">=</span> <span class="n">ELMS_THICKNESS</span>

<div class="viewcode-block" id="QuadRefinement.center_of_mass">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.center_of_mass">[docs]</a>
    <span class="k">def</span> <span class="nf">center_of_mass</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertices_coords</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the center of mass of the given vertices.</span>

<span class="sd">        This function computes the center of mass for the provided vertices coordinates.</span>

<span class="sd">        Args:</span>
<span class="sd">            vertices_coords (ndarray): Array of vertices coordinates.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray: The center of mass coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">vertices_coords</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="QuadRefinement.get_vertices_coords">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.get_vertices_coords">[docs]</a>
    <span class="k">def</span> <span class="nf">get_vertices_coords</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertices_tags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the coordinates of vertices.</span>

<span class="sd">        This function retrieves the coordinates of the specified vertices.</span>

<span class="sd">        Args:</span>
<span class="sd">            vertices_tags (List[int]): List of vertex tags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray: Array of vertex coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="n">vertices_coords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">vertex</span> <span class="ow">in</span> <span class="n">vertices_tags</span><span class="p">:</span>
            <span class="n">vertices_coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getValue</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">vertex</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vertices_coords</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span></div>


<div class="viewcode-block" id="QuadRefinement.create_square_grid">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.create_square_grid">[docs]</a>
    <span class="k">def</span> <span class="nf">create_square_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">big_square_size</span><span class="p">,</span> <span class="n">squares_per_side</span><span class="p">,</span> <span class="n">origin</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a grid of squares.</span>

<span class="sd">        This function generates a grid of squares based on the specified size and number of squares per side.</span>

<span class="sd">        Args:</span>
<span class="sd">            big_square_size (float): The size of the big square.</span>
<span class="sd">            squares_per_side (int): The number of squares per side.</span>
<span class="sd">            origin (List[float]): The origin coordinates.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[ndarray]: List of vertices coordinates for the grid.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Calculate the size of each small square</span>
        <span class="n">small_square_size</span> <span class="o">=</span> <span class="n">big_square_size</span> <span class="o">/</span> <span class="n">squares_per_side</span>

        <span class="n">vertices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">squares_per_side</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">squares_per_side</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="c1"># Calculate the coordinates of the square&#39;s top-left corner</span>
                <span class="n">x_s_1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">small_square_size</span><span class="p">)</span>
                <span class="n">y_s_1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">j</span> <span class="o">*</span> <span class="n">small_square_size</span><span class="p">)</span>
                <span class="n">vertices</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">x_s_1</span><span class="p">,</span> <span class="n">y_s_1</span><span class="p">,</span> <span class="n">origin</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

        <span class="c1"># center vertices to origing</span>
        <span class="n">vert_max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">vert_max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">vert_max_z</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">vertices</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">])[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">vertices_s</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">vert_max_x</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">vert_max_y</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">vert_max_z</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vertices</span>
        <span class="p">]</span>
        <span class="c1"># shift vertices to origin</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vertices_s</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">vertices</span></div>


<div class="viewcode-block" id="QuadRefinement.create_subvertices">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.create_subvertices">[docs]</a>
    <span class="k">def</span> <span class="nf">create_subvertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center_of_mass</span><span class="p">,</span> <span class="n">hierarchy</span><span class="p">,</span> <span class="n">square_size_0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create subvertices for the grid.</span>

<span class="sd">        This function generates subvertices for the grid based on the specified hierarchy and square size.</span>

<span class="sd">        Args:</span>
<span class="sd">            center_of_mass (ndarray): The center of mass coordinates.</span>
<span class="sd">            hierarchy (int): The hierarchy level.</span>
<span class="sd">            square_size_0 (float): The initial square size.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[ndarray]: List of subvertices coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">squares_per_side_1</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="n">hierarchy</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Hierarchy must be &gt;= 1&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">hierarchy</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">squares_per_side</span> <span class="o">=</span> <span class="n">squares_per_side_1</span> <span class="o">**</span> <span class="p">(</span><span class="n">hierarchy</span><span class="p">)</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_square_grid</span><span class="p">(</span>
            <span class="n">square_size_0</span><span class="p">,</span> <span class="n">squares_per_side</span><span class="p">,</span> <span class="n">center_of_mass</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">vertices</span></div>


<div class="viewcode-block" id="QuadRefinement.plot_vertices">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.plot_vertices">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertices</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot the vertices.</span>

<span class="sd">        This function plots the provided vertices and annotates their indices.</span>

<span class="sd">        Args:</span>
<span class="sd">            vertices (List[ndarray]): List of vertices coordinates.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">],</span>
            <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">],</span>
            <span class="s2">&quot;.&quot;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># annotate index of each vertex</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vertices</span><span class="p">):</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.01</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="QuadRefinement.gmsh_add_points">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.gmsh_add_points">[docs]</a>
    <span class="k">def</span> <span class="nf">gmsh_add_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertices</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add points to the Gmsh model.</span>

<span class="sd">        This function adds the provided vertices as points to the Gmsh model.</span>

<span class="sd">        Args:</span>
<span class="sd">            vertices (List[ndarray]): List of vertices coordinates.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[int]: List of point tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">point_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">:</span>
            <span class="n">v_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">point_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_tag</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">point_tags</span></div>


<div class="viewcode-block" id="QuadRefinement.gmsh_add_surfaces">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.gmsh_add_surfaces">[docs]</a>
    <span class="k">def</span> <span class="nf">gmsh_add_surfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_tags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add surfaces to the Gmsh model.</span>

<span class="sd">        This function adds surfaces to the Gmsh model based on the provided line tags.</span>

<span class="sd">        Args:</span>
<span class="sd">            line_tags (List[int]): List of line tags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[int]: List of surface tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cloops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">subline_tags</span> <span class="ow">in</span> <span class="n">line_tags</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="o">-</span><span class="mi">30</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">subline_tags</span><span class="p">)</span>
            <span class="n">curve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">(</span><span class="n">subline_tags</span><span class="p">,</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">cloops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>

        <span class="n">surf_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cloop</span> <span class="ow">in</span> <span class="n">cloops</span><span class="p">:</span>
            <span class="n">surf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addPlaneSurface</span><span class="p">([</span><span class="n">cloop</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">surf_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">surf_tags</span></div>


<div class="viewcode-block" id="QuadRefinement.get_vertices_minmax">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.get_vertices_minmax">[docs]</a>
    <span class="k">def</span> <span class="nf">get_vertices_minmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_coords</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the minimum and maximum vertices.</span>

<span class="sd">        This function retrieves the minimum and maximum vertices from the provided point coordinates.</span>

<span class="sd">        Args:</span>
<span class="sd">            point_coords (ndarray): Array of point coordinates.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray: Array of the four outermost vertices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">max_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">point_coords</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">min_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">point_coords</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">max_y</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">point_coords</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">min_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">point_coords</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># compose verts_2 with the 4 outermost vertices of point_coords</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">[</span><span class="n">max_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="n">min_x</span><span class="p">,</span> <span class="n">max_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="n">min_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="p">[</span><span class="n">max_x</span><span class="p">,</span> <span class="n">min_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">verts</span></div>


<div class="viewcode-block" id="QuadRefinement.get_affine_transformation_matrix">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.get_affine_transformation_matrix">[docs]</a>
    <span class="k">def</span> <span class="nf">get_affine_transformation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verts_1</span><span class="p">,</span> <span class="n">point_coords</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the affine transformation matrix.</span>

<span class="sd">        This function calculates the affine transformation matrix to map the provided vertices to the point coordinates.</span>

<span class="sd">        Args:</span>
<span class="sd">            verts_1 (ndarray): Array of vertices coordinates.</span>
<span class="sd">            point_coords (ndarray): Array of point coordinates.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray: The affine transformation matrix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># find 4 outermost vertices of point_coords</span>
        <span class="n">verts_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vertices_minmax</span><span class="p">(</span><span class="n">point_coords</span><span class="p">)</span>

        <span class="c1"># ensure c-continuity of verts_1 and verts_2 after slicing (as checked by cv::Mat::checkVector())</span>
        <span class="c1"># https://stackoverflow.com/questions/54552289/assertion-error-from-opencv-checkvector-in-python</span>
        <span class="n">verts_1_affine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">verts_1</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
        <span class="n">verts_2_affine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">verts_2</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getAffineTransform</span><span class="p">(</span><span class="n">verts_2_affine</span><span class="p">,</span> <span class="n">verts_1_affine</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHOW_PLOT</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">verts_1</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">verts_1</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">verts_2</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">verts_2</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">M</span></div>


<div class="viewcode-block" id="QuadRefinement.set_transformation_matrix">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.set_transformation_matrix">[docs]</a>
    <span class="k">def</span> <span class="nf">set_transformation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">point_coords</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply the affine transformation matrix.</span>

<span class="sd">        This function applies the affine transformation matrix to the provided point coordinates.</span>

<span class="sd">        Args:</span>
<span class="sd">            M (ndarray): The affine transformation matrix.</span>
<span class="sd">            point_coords (ndarray): Array of point coordinates.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray: Array of transformed coordinates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">point_coords</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">coords_transformed</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>
        <span class="n">new_coords</span> <span class="o">=</span> <span class="n">coords_transformed</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">new_coords_3d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">new_coords</span><span class="p">,</span> <span class="n">point_coords</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHOW_PLOT</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">point_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">point_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;original&quot;</span>
            <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">new_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">new_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;transformed&quot;</span>
            <span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">new_coords_3d</span></div>


<div class="viewcode-block" id="QuadRefinement.vertices_grid_cleanup">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.vertices_grid_cleanup">[docs]</a>
    <span class="k">def</span> <span class="nf">vertices_grid_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vertices</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Clean up the vertices grid.</span>

<span class="sd">        This function removes duplicate vertices and sorts the remaining vertices.</span>

<span class="sd">        Args:</span>
<span class="sd">            vertices (List[ndarray]): List of vertices coordinates.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray: Array of cleaned and sorted vertices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">vertices_unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="n">vertices</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
            <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">vertices_sorted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="nb">sorted</span><span class="p">(</span><span class="n">vertices_unique</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span> <span class="p">[</span><span class="n">k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]]),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">vertices_sorted</span></div>


<div class="viewcode-block" id="QuadRefinement.gmsh_add_line">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.gmsh_add_line">[docs]</a>
    <span class="k">def</span> <span class="nf">gmsh_add_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_skins</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add lines to the Gmsh model.</span>

<span class="sd">        This function adds lines to the Gmsh model based on the provided point skins.</span>

<span class="sd">        Args:</span>
<span class="sd">            point_skins (List[ndarray]): List of point skins.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[Tuple[int, int, int, int]]: List of line tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">line_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">_iter</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># slicing iterator</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">skin</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">point_skins</span><span class="p">[::</span><span class="n">_iter</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">skin</span><span class="p">[::</span><span class="n">_iter</span><span class="p">]):</span>
                <span class="n">p0</span> <span class="o">=</span> <span class="n">skin</span><span class="p">[</span><span class="n">j</span> <span class="o">*</span> <span class="n">_iter</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">skin</span><span class="p">[</span><span class="n">j</span> <span class="o">*</span> <span class="n">_iter</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="n">skin</span><span class="p">[</span><span class="n">j</span> <span class="o">*</span> <span class="n">_iter</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">p3</span> <span class="o">=</span> <span class="n">skin</span><span class="p">[</span><span class="n">j</span> <span class="o">*</span> <span class="n">_iter</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">line_s1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">line_s2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">line_s3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">line_s4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">line_tags</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">line_s1</span><span class="p">,</span> <span class="n">line_s2</span><span class="p">,</span> <span class="n">line_s3</span><span class="p">,</span> <span class="n">line_s4</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">line_tags</span></div>


<div class="viewcode-block" id="QuadRefinement.gmsh_add_plane_surface">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.gmsh_add_plane_surface">[docs]</a>
    <span class="k">def</span> <span class="nf">gmsh_add_plane_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_tags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a plane surface to the Gmsh model.</span>

<span class="sd">        This function creates a plane surface from the provided line tags and adds it to the Gmsh model.</span>

<span class="sd">        Args:</span>
<span class="sd">            line_tags (List[int]): List of line tags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The tag of the created plane surface.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">center_cloop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">(</span><span class="n">line_tags</span><span class="p">,</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">center_surf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addPlaneSurface</span><span class="p">([</span><span class="n">center_cloop</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">center_surf</span></div>


<div class="viewcode-block" id="QuadRefinement.gmsh_add_custom_lines">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.gmsh_add_custom_lines">[docs]</a>
    <span class="k">def</span> <span class="nf">gmsh_add_custom_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_tags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add lines to the Gmsh model of the internal refined structure.</span>

<span class="sd">        This function adds custom lines to the Gmsh model based on the provided point tags. It includes</span>
<span class="sd">        center squares, diagonal lines, border squares, center trapezoids, diagonal trapezoids, and outer squares.</span>

<span class="sd">        Args:</span>
<span class="sd">            point_tags (List[int]): List of point tags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[List[int], List[int]]: Tuple containing the line tags and outer square line tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># insert 5 tags at the beginning of the list (4 of the vertices and 1 for starting the count at 1 and not 0)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">point_tags</span>
        <span class="c1"># add center square</span>
        <span class="n">l1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">71</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">71</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">68</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">68</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">center_square</span> <span class="o">=</span> <span class="p">[</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">l3</span><span class="p">,</span> <span class="n">l4</span><span class="p">]</span>

        <span class="c1"># add diagonal lines</span>
        <span class="n">ld1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">27</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ld2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">32</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ld3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">71</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">82</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ld4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">68</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">77</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">diagonal_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">ld1</span><span class="p">,</span> <span class="n">ld2</span><span class="p">,</span> <span class="n">ld3</span><span class="p">,</span> <span class="n">ld4</span><span class="p">]</span>

        <span class="c1"># add 4 squares connecting to the diagonal lines</span>
        <span class="n">l10</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">27</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">26</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l11</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">26</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l12</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l13</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">27</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l20</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">32</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">33</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l21</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">33</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">23</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l22</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">23</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">32</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l30</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">82</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">83</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l31</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">83</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">93</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l32</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">93</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">92</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">92</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">82</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l40</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">77</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">76</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l41</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">76</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">86</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l42</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">86</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">87</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l43</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">87</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">77</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">border_squares</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">l10</span><span class="p">,</span>
            <span class="n">l11</span><span class="p">,</span>
            <span class="n">l12</span><span class="p">,</span>
            <span class="n">l13</span><span class="p">,</span>
            <span class="n">l20</span><span class="p">,</span>
            <span class="n">l21</span><span class="p">,</span>
            <span class="n">l22</span><span class="p">,</span>
            <span class="n">l23</span><span class="p">,</span>
            <span class="n">l30</span><span class="p">,</span>
            <span class="n">l31</span><span class="p">,</span>
            <span class="n">l32</span><span class="p">,</span>
            <span class="n">l33</span><span class="p">,</span>
            <span class="n">l40</span><span class="p">,</span>
            <span class="n">l41</span><span class="p">,</span>
            <span class="n">l42</span><span class="p">,</span>
            <span class="n">l43</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># center trapezoids</span>
        <span class="n">l51</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">29</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l52</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">29</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">30</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l53</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">30</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l61</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">52</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l62</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">52</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">62</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l63</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">62</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">71</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l71</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">71</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">80</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l72</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">80</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">79</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l73</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">79</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">68</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l81</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">68</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">57</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l82</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">57</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">47</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l83</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">47</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">center_trapezoids</span> <span class="o">=</span> <span class="p">[</span><span class="n">l51</span><span class="p">,</span> <span class="n">l52</span><span class="p">,</span> <span class="n">l53</span><span class="p">,</span> <span class="n">l61</span><span class="p">,</span> <span class="n">l62</span><span class="p">,</span> <span class="n">l63</span><span class="p">,</span> <span class="n">l71</span><span class="p">,</span> <span class="n">l72</span><span class="p">,</span> <span class="n">l73</span><span class="p">,</span> <span class="n">l81</span><span class="p">,</span> <span class="n">l82</span><span class="p">,</span> <span class="n">l83</span><span class="p">]</span>

        <span class="c1"># diagonal trapezoids</span>
        <span class="n">l911</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l912</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l913</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">19</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l914</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">19</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">29</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l921</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l922</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l923</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l924</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">30</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l931</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">43</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l932</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">43</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">53</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l933</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">53</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">52</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l934</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">43</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">33</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l941</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">71</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">73</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l942</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">73</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">63</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l943</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">63</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">62</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l944</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">73</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">83</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l951</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">71</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">91</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l952</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">91</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">92</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l953</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">91</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">90</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l954</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">90</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">80</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l961</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">68</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">88</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l962</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">88</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">87</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l963</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">88</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">89</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l964</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">89</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">79</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l971</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">68</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">66</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l972</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">66</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">56</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l973</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">56</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">57</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l974</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">66</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">76</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l981</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">36</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l982</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">36</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">46</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l983</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">46</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">47</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l984</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">36</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">26</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">trapezoids</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">l911</span><span class="p">,</span>
            <span class="n">l912</span><span class="p">,</span>
            <span class="n">l913</span><span class="p">,</span>
            <span class="n">l914</span><span class="p">,</span>
            <span class="n">l921</span><span class="p">,</span>
            <span class="n">l922</span><span class="p">,</span>
            <span class="n">l923</span><span class="p">,</span>
            <span class="n">l924</span><span class="p">,</span>
            <span class="n">l931</span><span class="p">,</span>
            <span class="n">l932</span><span class="p">,</span>
            <span class="n">l933</span><span class="p">,</span>
            <span class="n">l934</span><span class="p">,</span>
            <span class="n">l941</span><span class="p">,</span>
            <span class="n">l942</span><span class="p">,</span>
            <span class="n">l943</span><span class="p">,</span>
            <span class="n">l944</span><span class="p">,</span>
            <span class="n">l951</span><span class="p">,</span>
            <span class="n">l952</span><span class="p">,</span>
            <span class="n">l953</span><span class="p">,</span>
            <span class="n">l954</span><span class="p">,</span>
            <span class="n">l961</span><span class="p">,</span>
            <span class="n">l962</span><span class="p">,</span>
            <span class="n">l963</span><span class="p">,</span>
            <span class="n">l964</span><span class="p">,</span>
            <span class="n">l971</span><span class="p">,</span>
            <span class="n">l972</span><span class="p">,</span>
            <span class="n">l973</span><span class="p">,</span>
            <span class="n">l974</span><span class="p">,</span>
            <span class="n">l981</span><span class="p">,</span>
            <span class="n">l982</span><span class="p">,</span>
            <span class="n">l983</span><span class="p">,</span>
            <span class="n">l984</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># close squares of 1st level</span>
        <span class="n">l975</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">19</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l976</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">53</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">63</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l977</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">90</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">89</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l978</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">56</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">46</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">center_squares_first_lvl</span> <span class="o">=</span> <span class="p">[</span><span class="n">l975</span><span class="p">,</span> <span class="n">l976</span><span class="p">,</span> <span class="n">l977</span><span class="p">,</span> <span class="n">l978</span><span class="p">]</span>

        <span class="c1"># TODO: add &#39;if&#39; depending on number of subdivisions, now works for only 2 subdivisions</span>
        <span class="c1"># assignee: @simoneponcioni</span>
        <span class="c1"># add outer squares</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">pt</span>
        <span class="n">l100</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">19</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l101</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">19</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">29</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l102</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">29</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">39</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l103</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">39</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">49</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l104</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">49</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">59</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l105</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">59</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">69</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l106</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">69</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">79</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l107</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">79</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">89</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l108</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">89</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">99</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l109</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l110</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">19</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l111</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">29</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">30</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l112</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">39</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">40</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l113</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">49</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l114</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">59</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">60</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l115</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">69</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">70</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l116</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">79</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">80</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l117</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">89</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">90</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l118</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">99</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">100</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l120</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">20</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l121</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">90</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">100</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l130</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l131</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l132</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l133</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l134</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l135</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l136</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l137</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l140</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l141</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l142</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">23</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l143</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">24</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l144</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">25</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l145</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">26</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l146</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">27</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l147</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">28</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l148</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">27</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">28</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l150</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">28</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l151</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">48</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l152</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">48</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">58</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l153</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">58</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">68</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l154</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">68</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">78</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l155</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">78</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">88</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l156</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">88</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">98</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l157</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">98</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">108</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l160</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">37</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l161</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">47</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">48</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l162</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">57</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">58</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l163</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">67</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">68</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l164</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">77</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">78</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l165</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">87</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">88</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l166</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">97</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">98</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l167</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">107</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">108</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l170</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">100</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">101</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l171</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">101</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">102</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l172</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">102</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">103</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l173</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">103</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">104</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l174</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">104</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">105</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l175</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">105</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">106</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l176</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">106</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">107</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">l180</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">91</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">101</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l181</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">92</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">102</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l182</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">93</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">103</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l183</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">94</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">104</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l184</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">95</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">105</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l185</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">96</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">106</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">l186</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt</span><span class="p">[</span><span class="mi">97</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">107</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">outer_square</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">l100</span><span class="p">,</span>
            <span class="n">l101</span><span class="p">,</span>
            <span class="n">l102</span><span class="p">,</span>
            <span class="n">l103</span><span class="p">,</span>
            <span class="n">l104</span><span class="p">,</span>
            <span class="n">l105</span><span class="p">,</span>
            <span class="n">l106</span><span class="p">,</span>
            <span class="n">l107</span><span class="p">,</span>
            <span class="n">l108</span><span class="p">,</span>
            <span class="n">l109</span><span class="p">,</span>
            <span class="n">l110</span><span class="p">,</span>
            <span class="n">l111</span><span class="p">,</span>
            <span class="n">l112</span><span class="p">,</span>
            <span class="n">l113</span><span class="p">,</span>
            <span class="n">l114</span><span class="p">,</span>
            <span class="n">l115</span><span class="p">,</span>
            <span class="n">l116</span><span class="p">,</span>
            <span class="n">l117</span><span class="p">,</span>
            <span class="n">l118</span><span class="p">,</span>
            <span class="n">l120</span><span class="p">,</span>
            <span class="n">l121</span><span class="p">,</span>
            <span class="n">l130</span><span class="p">,</span>
            <span class="n">l131</span><span class="p">,</span>
            <span class="n">l132</span><span class="p">,</span>
            <span class="n">l133</span><span class="p">,</span>
            <span class="n">l134</span><span class="p">,</span>
            <span class="n">l135</span><span class="p">,</span>
            <span class="n">l136</span><span class="p">,</span>
            <span class="n">l137</span><span class="p">,</span>
            <span class="n">l140</span><span class="p">,</span>
            <span class="n">l141</span><span class="p">,</span>
            <span class="n">l142</span><span class="p">,</span>
            <span class="n">l143</span><span class="p">,</span>
            <span class="n">l144</span><span class="p">,</span>
            <span class="n">l145</span><span class="p">,</span>
            <span class="n">l146</span><span class="p">,</span>
            <span class="n">l147</span><span class="p">,</span>
            <span class="n">l148</span><span class="p">,</span>
            <span class="n">l150</span><span class="p">,</span>
            <span class="n">l151</span><span class="p">,</span>
            <span class="n">l152</span><span class="p">,</span>
            <span class="n">l153</span><span class="p">,</span>
            <span class="n">l154</span><span class="p">,</span>
            <span class="n">l155</span><span class="p">,</span>
            <span class="n">l156</span><span class="p">,</span>
            <span class="n">l157</span><span class="p">,</span>
            <span class="n">l160</span><span class="p">,</span>
            <span class="n">l161</span><span class="p">,</span>
            <span class="n">l162</span><span class="p">,</span>
            <span class="n">l163</span><span class="p">,</span>
            <span class="n">l164</span><span class="p">,</span>
            <span class="n">l165</span><span class="p">,</span>
            <span class="n">l166</span><span class="p">,</span>
            <span class="n">l167</span><span class="p">,</span>
            <span class="n">l170</span><span class="p">,</span>
            <span class="n">l171</span><span class="p">,</span>
            <span class="n">l172</span><span class="p">,</span>
            <span class="n">l173</span><span class="p">,</span>
            <span class="n">l174</span><span class="p">,</span>
            <span class="n">l175</span><span class="p">,</span>
            <span class="n">l176</span><span class="p">,</span>
            <span class="n">l180</span><span class="p">,</span>
            <span class="n">l181</span><span class="p">,</span>
            <span class="n">l182</span><span class="p">,</span>
            <span class="n">l183</span><span class="p">,</span>
            <span class="n">l184</span><span class="p">,</span>
            <span class="n">l185</span><span class="p">,</span>
            <span class="n">l186</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">line_tags</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">center_square</span><span class="p">,</span>
            <span class="n">diagonal_lines</span><span class="p">,</span>
            <span class="n">border_squares</span><span class="p">,</span>
            <span class="n">center_trapezoids</span><span class="p">,</span>
            <span class="n">trapezoids</span><span class="p">,</span>
            <span class="n">center_squares_first_lvl</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">line_tags</span><span class="p">,</span> <span class="n">outer_square</span></div>


<div class="viewcode-block" id="QuadRefinement.gmsh_skin_points">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.gmsh_skin_points">[docs]</a>
    <span class="k">def</span> <span class="nf">gmsh_skin_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_tags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a grid of point skins.</span>

<span class="sd">        This function generates a grid of point skins from the provided point tags.</span>

<span class="sd">        Args:</span>
<span class="sd">            point_tags (List[int]): List of point tags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray: Array of point skins.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sqrt_shape</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">point_tags</span><span class="p">)))</span>
        <span class="n">windows</span> <span class="o">=</span> <span class="n">view_as_windows</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">point_tags</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">sqrt_shape</span><span class="p">,</span> <span class="n">sqrt_shape</span><span class="p">)),</span>
            <span class="n">window_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
            <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">windows</span></div>


<div class="viewcode-block" id="QuadRefinement.gmsh_add_surfs">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.gmsh_add_surfs">[docs]</a>
    <span class="k">def</span> <span class="nf">gmsh_add_surfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_tags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add surfaces to the Gmsh model.</span>

<span class="sd">        This function adds surfaces to the Gmsh model based on the provided line tags. It includes</span>
<span class="sd">        center surfaces, border squares, center trapezoids, and additional surfaces.</span>

<span class="sd">        Args:</span>
<span class="sd">            l_tags (List[int]): List of line tags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[int]: List of surface tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">surf_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">center_surf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsh_add_plane_surface</span><span class="p">(</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">surf_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">center_surf</span><span class="p">)</span>

        <span class="n">border_squares_split</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">border_tags</span> <span class="ow">in</span> <span class="n">border_squares_split</span><span class="p">:</span>
            <span class="n">_surf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsh_add_plane_surface</span><span class="p">(</span><span class="n">border_tags</span><span class="p">)</span>
            <span class="n">surf_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_surf</span><span class="p">)</span>

        <span class="n">center_trapezoids_split</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">4</span><span class="p">)</span>
        <span class="c1"># add center_square to center_trapezoids_split</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">center_line_tag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">center_trapezoids_split</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">center_trapezoids_split</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">center_line_tag</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">trapezoid</span> <span class="ow">in</span> <span class="n">center_trapezoids_split</span><span class="p">:</span>
            <span class="n">_surf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsh_add_plane_surface</span><span class="p">(</span><span class="n">trapezoid</span><span class="p">)</span>
            <span class="n">surf_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_surf</span><span class="p">)</span>

        <span class="n">cl_1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">cl_2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">11</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">8</span><span class="p">]])</span>
        <span class="n">cl_3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">8</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">12</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">15</span><span class="p">]])</span>
        <span class="n">cl_4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">12</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">24</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">27</span><span class="p">]])</span>

        <span class="n">cl_5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">31</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">28</span><span class="p">]])</span>
        <span class="n">cl_6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">7</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">4</span><span class="p">]])</span>
        <span class="n">cl_7</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">11</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">17</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">16</span><span class="p">]])</span>
        <span class="n">cl_8</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">15</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">21</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">20</span><span class="p">]])</span>

        <span class="n">cl_9</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">3</span><span class="p">]])</span>
        <span class="n">cl_10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">7</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">4</span><span class="p">]])</span>
        <span class="n">cl_11</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">8</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">9</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">10</span><span class="p">]])</span>
        <span class="n">cl_12</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">14</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">13</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">12</span><span class="p">]])</span>
        <span class="n">cl_13</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">16</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">18</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">19</span><span class="p">]])</span>
        <span class="n">cl_14</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">8</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">23</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">22</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">20</span><span class="p">]])</span>
        <span class="n">cl_15</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">9</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">24</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">25</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">26</span><span class="p">]])</span>
        <span class="n">cl_16</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">11</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">30</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">28</span><span class="p">]])</span>

        <span class="n">cl_17</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">7</span><span class="p">]])</span>
        <span class="n">cl_18</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">10</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">14</span><span class="p">]])</span>
        <span class="n">cl_19</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">7</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">19</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">23</span><span class="p">]])</span>
        <span class="n">cl_20</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">l_tags</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">10</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">26</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span> <span class="n">l_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">30</span><span class="p">]])</span>

        <span class="n">loops</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">cl_1</span><span class="p">,</span>
            <span class="n">cl_2</span><span class="p">,</span>
            <span class="n">cl_3</span><span class="p">,</span>
            <span class="n">cl_4</span><span class="p">,</span>
            <span class="n">cl_5</span><span class="p">,</span>
            <span class="n">cl_6</span><span class="p">,</span>
            <span class="n">cl_7</span><span class="p">,</span>
            <span class="n">cl_8</span><span class="p">,</span>
            <span class="n">cl_9</span><span class="p">,</span>
            <span class="n">cl_10</span><span class="p">,</span>
            <span class="n">cl_11</span><span class="p">,</span>
            <span class="n">cl_12</span><span class="p">,</span>
            <span class="n">cl_13</span><span class="p">,</span>
            <span class="n">cl_14</span><span class="p">,</span>
            <span class="n">cl_15</span><span class="p">,</span>
            <span class="n">cl_16</span><span class="p">,</span>
            <span class="n">cl_17</span><span class="p">,</span>
            <span class="n">cl_18</span><span class="p">,</span>
            <span class="n">cl_19</span><span class="p">,</span>
            <span class="n">cl_20</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">curve_loop</span> <span class="ow">in</span> <span class="n">loops</span><span class="p">:</span>
            <span class="n">_surf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsh_add_plane_surface</span><span class="p">(</span><span class="n">curve_loop</span><span class="p">)</span>
            <span class="n">surf_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_surf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">surf_tags</span></div>


<div class="viewcode-block" id="QuadRefinement.gmsh_make_transfinite">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.gmsh_make_transfinite">[docs]</a>
    <span class="k">def</span> <span class="nf">gmsh_make_transfinite</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_tags</span><span class="p">,</span> <span class="n">surf_tags</span><span class="p">,</span> <span class="n">n_trans</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set transfinite meshing for lines and surfaces.</span>

<span class="sd">        This function sets transfinite meshing for the provided lines and surfaces.</span>

<span class="sd">        Args:</span>
<span class="sd">            line_tags (List[int]): List of line tags.</span>
<span class="sd">            surf_tags (List[int]): List of surface tags.</span>
<span class="sd">            n_trans (int): Number of transfinite divisions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">subset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line_tags</span><span class="p">):</span>
            <span class="n">subset</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">subset</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setTransfiniteCurve</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">n_trans</span><span class="p">,</span> <span class="s2">&quot;Progression&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">surf</span> <span class="ow">in</span> <span class="n">surf_tags</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setTransfiniteSurface</span><span class="p">(</span><span class="n">surf</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="QuadRefinement.gmsh_get_unique_surfaces">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.gmsh_get_unique_surfaces">[docs]</a>
    <span class="k">def</span> <span class="nf">gmsh_get_unique_surfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve_loop</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get unique surfaces from curve loops.</span>

<span class="sd">        This function retrieves unique surfaces from the provided curve loops.</span>

<span class="sd">        Args:</span>
<span class="sd">            curve_loop (List[int]): List of curve loop tags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray: Array of unique surface tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_surfaces</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">curve_loop</span><span class="p">:</span>
            <span class="n">adjacent_surfaces</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getAdjacencies</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">curve</span><span class="p">)</span>
            <span class="n">all_surfaces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adjacent_surfaces</span><span class="p">)</span>

        <span class="c1"># combine all surfaces into one list with no duplicates</span>
        <span class="n">all_surfaces_flat</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">all_surfaces</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="n">unique_surfaces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">all_surfaces_flat</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">unique_surfaces</span></div>


<div class="viewcode-block" id="QuadRefinement.gmsh_add_outer_connectivity">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.gmsh_add_outer_connectivity">[docs]</a>
    <span class="k">def</span> <span class="nf">gmsh_add_outer_connectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_tags</span><span class="p">,</span> <span class="n">initial_point_tags</span><span class="p">,</span> <span class="n">point_tags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add outer connectivity to the Gmsh model.</span>

<span class="sd">        This function adds outer connectivity lines and surfaces to the Gmsh model based on the provided</span>
<span class="sd">        line tags and point tags.</span>

<span class="sd">        Args:</span>
<span class="sd">            line_tags (List[int]): List of line tags.</span>
<span class="sd">            initial_point_tags (List[int]): List of initial point tags.</span>
<span class="sd">            point_tags (List[int]): List of point tags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[List[int], List[int], List[int], List[Tuple[int, int, int, int]]]:</span>
<span class="sd">                - Updated line tags.</span>
<span class="sd">                - List of external surface tags.</span>
<span class="sd">                - List of curve loop line tags.</span>
<span class="sd">                - List of corner points for transfinite surfaces.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># insert 5 tags at the beginning of the list (4 of the vertices and 1 for starting the count at 1 and not 0)</span>
        <span class="n">pt</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">point_tags</span>

        <span class="c1"># external lines</span>
        <span class="n">ext_lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span>
                <span class="n">initial_point_tags</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">initial_point_tags</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">ext_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_line</span><span class="p">)</span>

        <span class="c1"># connecting lines</span>
        <span class="n">connecting_lines</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="n">initial_point_tags</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">93</span><span class="p">]],</span>
            <span class="p">[</span><span class="n">initial_point_tags</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">86</span><span class="p">]],</span>
            <span class="p">[</span><span class="n">initial_point_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">16</span><span class="p">]],</span>
            <span class="p">[</span><span class="n">initial_point_tags</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">pt</span><span class="p">[</span><span class="mi">23</span><span class="p">]],</span>
        <span class="p">]</span>

        <span class="c1"># + 4</span>
        <span class="c1"># line_01 = self.factory.addLine(pt[16], pt[15])</span>
        <span class="c1"># line_02 = self.factory.addLine(pt[16], pt[6])</span>
        <span class="n">line_01</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span>
            <span class="n">connecting_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">connecting_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">line_02</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span>
            <span class="n">connecting_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">connecting_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">line_03</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span>
            <span class="n">connecting_lines</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">connecting_lines</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">line_04</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span>
            <span class="n">connecting_lines</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">connecting_lines</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">conn_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line_01</span><span class="p">,</span> <span class="n">line_02</span><span class="p">,</span> <span class="n">line_03</span><span class="p">,</span> <span class="n">line_04</span><span class="p">]</span>

        <span class="n">line_tags_new</span> <span class="o">=</span> <span class="n">line_tags</span> <span class="o">+</span> <span class="p">(</span>
            <span class="n">ext_lines</span><span class="p">,</span>
            <span class="n">conn_lines</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">ext_lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">ext_lines</span><span class="p">))</span>
        <span class="n">conn_lines</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">conn_lines</span><span class="p">))</span>

        <span class="c1"># make the lines transfinite</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">ext_lines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setTransfiniteCurve</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="s2">&quot;Progression&quot;</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="c1"># for line in conn_lines:</span>
        <span class="c1">#     self.model.mesh.setTransfiniteCurve(line, 1, &quot;Progression&quot;, 1.0)</span>

        <span class="n">cl_s_01</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ext_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">conn_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">9</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">15</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">13</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">9</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">11</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span>
            <span class="n">conn_lines</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="p">]</span>

        <span class="n">cl_s_02</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ext_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">conn_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">14</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">21</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">22</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">18</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">17</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">10</span><span class="p">],</span>
            <span class="n">conn_lines</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">]</span>

        <span class="n">cl_s_03</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ext_lines</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">conn_lines</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">31</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">29</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">3</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">25</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">27</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">13</span><span class="p">],</span>
            <span class="n">conn_lines</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">]</span>

        <span class="n">cl_s_04</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ext_lines</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="n">conn_lines</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">5</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">6</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">line_tags</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">conn_lines</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
        <span class="p">]</span>

        <span class="n">curve_loops_line_tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">cl_s_01</span><span class="p">,</span> <span class="n">cl_s_02</span><span class="p">,</span> <span class="n">cl_s_03</span><span class="p">,</span> <span class="n">cl_s_04</span><span class="p">]</span>
        <span class="n">curve_loops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">curve_loops_line_tags</span><span class="p">:</span>
            <span class="n">_cl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">(</span><span class="n">cl</span><span class="p">,</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">curve_loops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_cl</span><span class="p">)</span>

        <span class="n">ext_surf_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">curve_loops</span><span class="p">:</span>
            <span class="n">_surf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addPlaneSurface</span><span class="p">([</span><span class="n">cl</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ext_surf_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_surf</span><span class="p">)</span>

        <span class="c1"># insert connecting line to connecting_lines_app</span>
        <span class="n">connecting_lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">connecting_lines</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="n">ext_surf_tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">ext_surf_tags</span><span class="p">))</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ext_surf_tags</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">corners_s</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">connecting_lines</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">connecting_lines</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">connecting_lines</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">connecting_lines</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">ext_surf_tags</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">corners_s</span><span class="p">)</span>
            <span class="c1"># self.model.mesh.setTransfiniteSurface(</span>
            <span class="c1">#     ext_surf_tags[i - 1],</span>
            <span class="c1">#     cornerTags=corners_s,</span>
            <span class="c1"># )</span>
            <span class="n">corners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">corners_s</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">line_tags_new</span><span class="p">,</span> <span class="n">ext_surf_tags</span><span class="p">,</span> <span class="n">curve_loops_line_tags</span><span class="p">,</span> <span class="n">corners</span></div>


<div class="viewcode-block" id="QuadRefinement.create_connecting_surfaces">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.create_connecting_surfaces">[docs]</a>
    <span class="k">def</span> <span class="nf">create_connecting_surfaces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve_loops_line_tags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create connecting surfaces between curve loops.</span>

<span class="sd">        This function creates connecting surfaces between the provided curve loops.</span>

<span class="sd">        Args:</span>
<span class="sd">            curve_loops_line_tags (List[int]): List of curve loop line tags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[ndarray]: List of surface loops.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="n">surface_loops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">surface_loops_t</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">curve_loops_line_tags</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">curve_loops_line_tags</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
                <span class="n">unique_surfaces_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsh_get_unique_surfaces</span><span class="p">(</span>
                    <span class="n">curve_loops_line_tags</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">unique_surface_next</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsh_get_unique_surfaces</span><span class="p">(</span>
                    <span class="n">curve_loops_line_tags</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="p">)</span>
                <span class="n">surfaces_app</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unique_surfaces_s</span><span class="p">,</span> <span class="n">unique_surface_next</span><span class="p">)</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">surfaces_app</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
                <span class="n">m</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">surfaces_app</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">surface_loops_t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surfaces_app</span><span class="p">[</span><span class="o">~</span><span class="n">m</span><span class="p">])</span>
            <span class="n">surface_loops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surface_loops_t</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">surface_loops</span></div>


<div class="viewcode-block" id="QuadRefinement.close_outer_loop">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.close_outer_loop">[docs]</a>
    <span class="k">def</span> <span class="nf">close_outer_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">line_tags</span><span class="p">,</span> <span class="n">outer_square_lines</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Close the outer loop with surfaces.</span>

<span class="sd">        This function closes the outer loop by creating surfaces from the provided line tags and outer square lines.</span>

<span class="sd">        Args:</span>
<span class="sd">            line_tags (List[int]): List of line tags.</span>
<span class="sd">            outer_square_lines (List[int]): List of outer square line tags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[int]: List of surface tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># read all the lines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="n">line_tags_f</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">line_tags</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="n">line_tags</span> <span class="o">=</span> <span class="n">line_tags_f</span> <span class="o">+</span> <span class="n">outer_square_lines</span>

        <span class="c1"># start line indices at 1</span>
        <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_tags</span>

        <span class="n">curve_loop_30</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">73</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">83</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">92</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">82</span><span class="p">]]</span>
        <span class="n">curve_loop_31</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">74</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">84</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">83</span><span class="p">]]</span>
        <span class="n">curve_loop_32</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">75</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">85</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">68</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">84</span><span class="p">]]</span>
        <span class="n">curve_loop_33</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">76</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">86</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">66</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">85</span><span class="p">]]</span>
        <span class="n">curve_loop_34</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">77</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">87</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">72</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">86</span><span class="p">]]</span>
        <span class="n">curve_loop_35</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">78</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">88</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">62</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">87</span><span class="p">]]</span>
        <span class="n">curve_loop_36</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">79</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">89</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">88</span><span class="p">]]</span>
        <span class="n">curve_loop_37</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">80</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">90</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">89</span><span class="p">]]</span>
        <span class="n">curve_loop_38</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">81</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">91</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">93</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">90</span><span class="p">]]</span>
        <span class="n">curve_loop_39</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">93</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">127</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">134</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">23</span><span class="p">]]</span>
        <span class="n">curve_loop_40</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">134</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">128</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">135</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">58</span><span class="p">]]</span>
        <span class="n">curve_loop_41</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">135</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">129</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">136</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">59</span><span class="p">]]</span>
        <span class="n">curve_loop_42</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">136</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">130</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">137</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">71</span><span class="p">]]</span>
        <span class="n">curve_loop_43</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">137</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">131</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">138</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">55</span><span class="p">]]</span>
        <span class="n">curve_loop_44</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">138</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">132</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">139</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">54</span><span class="p">]]</span>
        <span class="n">curve_loop_45</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">139</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">133</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">140</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">19</span><span class="p">]]</span>
        <span class="n">curve_loop_46</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">140</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">126</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">118</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">125</span><span class="p">]]</span>
        <span class="n">curve_loop_47</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">125</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">117</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">124</span><span class="p">]]</span>
        <span class="n">curve_loop_48</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">124</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">116</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">123</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">52</span><span class="p">]]</span>
        <span class="n">curve_loop_49</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">123</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">115</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">122</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">50</span><span class="p">]]</span>
        <span class="n">curve_loop_50</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">122</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">114</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">121</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">70</span><span class="p">]]</span>
        <span class="n">curve_loop_51</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">121</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">113</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">120</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">46</span><span class="p">]]</span>
        <span class="n">curve_loop_52</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">120</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">112</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">119</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">48</span><span class="p">]]</span>
        <span class="n">curve_loop_53</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">119</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">111</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">110</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">14</span><span class="p">]]</span>
        <span class="n">curve_loop_54</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">110</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">109</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">101</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">108</span><span class="p">]]</span>
        <span class="n">curve_loop_55</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">108</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">107</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">100</span><span class="p">]]</span>
        <span class="n">curve_loop_56</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">107</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">42</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">106</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">99</span><span class="p">]]</span>
        <span class="n">curve_loop_57</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">106</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">43</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">105</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">98</span><span class="p">]]</span>
        <span class="n">curve_loop_58</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">105</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">69</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">104</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">97</span><span class="p">]]</span>
        <span class="n">curve_loop_59</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">104</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">39</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">103</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">96</span><span class="p">]]</span>
        <span class="n">curve_loop_60</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">103</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">102</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">95</span><span class="p">]]</span>
        <span class="n">curve_loop_61</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">[</span><span class="mi">102</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">92</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="mi">94</span><span class="p">]]</span>

        <span class="c1"># concatenate in list all curve loops</span>
        <span class="n">curve_loops_outer</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">curve_loop_30</span><span class="p">,</span>
            <span class="n">curve_loop_31</span><span class="p">,</span>
            <span class="n">curve_loop_32</span><span class="p">,</span>
            <span class="n">curve_loop_33</span><span class="p">,</span>
            <span class="n">curve_loop_34</span><span class="p">,</span>
            <span class="n">curve_loop_35</span><span class="p">,</span>
            <span class="n">curve_loop_36</span><span class="p">,</span>
            <span class="n">curve_loop_37</span><span class="p">,</span>
            <span class="n">curve_loop_38</span><span class="p">,</span>
            <span class="n">curve_loop_39</span><span class="p">,</span>
            <span class="n">curve_loop_40</span><span class="p">,</span>
            <span class="n">curve_loop_41</span><span class="p">,</span>
            <span class="n">curve_loop_42</span><span class="p">,</span>
            <span class="n">curve_loop_43</span><span class="p">,</span>
            <span class="n">curve_loop_44</span><span class="p">,</span>
            <span class="n">curve_loop_45</span><span class="p">,</span>
            <span class="n">curve_loop_46</span><span class="p">,</span>
            <span class="n">curve_loop_47</span><span class="p">,</span>
            <span class="n">curve_loop_48</span><span class="p">,</span>
            <span class="n">curve_loop_49</span><span class="p">,</span>
            <span class="n">curve_loop_50</span><span class="p">,</span>
            <span class="n">curve_loop_51</span><span class="p">,</span>
            <span class="n">curve_loop_52</span><span class="p">,</span>
            <span class="n">curve_loop_53</span><span class="p">,</span>
            <span class="n">curve_loop_54</span><span class="p">,</span>
            <span class="n">curve_loop_55</span><span class="p">,</span>
            <span class="n">curve_loop_56</span><span class="p">,</span>
            <span class="n">curve_loop_57</span><span class="p">,</span>
            <span class="n">curve_loop_58</span><span class="p">,</span>
            <span class="n">curve_loop_59</span><span class="p">,</span>
            <span class="n">curve_loop_60</span><span class="p">,</span>
            <span class="n">curve_loop_61</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="n">surf</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">curve_loops_outer</span><span class="p">:</span>
            <span class="n">curve_loop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
            <span class="n">surf_s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addPlaneSurface</span><span class="p">([</span><span class="n">curve_loop</span><span class="p">])</span>
            <span class="n">surf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surf_s</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">surf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setTransfiniteSurface</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">surf</span></div>


<div class="viewcode-block" id="QuadRefinement.quad_refinement">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.quad_refinement">[docs]</a>
    <span class="k">def</span> <span class="nf">quad_refinement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_point_tags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform quadrilateral refinement on the given initial point tags.</span>

<span class="sd">        This function refines the quadrilateral mesh based on the initial point tags. It creates subvertices,</span>
<span class="sd">        sorts them, applies an affine transformation, and adds points, lines, and surfaces to the Gmsh model.</span>

<span class="sd">        Args:</span>
<span class="sd">            initial_point_tags (List[int]): List of initial point tags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[List[int], List[int], List[int]]: Tuple containing the point tags, line tags, and surface tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">SQUARE_SIZE_0_MM</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SQUARE_SIZE_0_MM</span>
        <span class="n">MAX_SUBDIVISIONS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_SUBDIVISIONS</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;* 1. Get the vertices coordinates from self.vertices_tags&quot;</span><span class="p">)</span>
        <span class="n">vertices_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_vertices_coords</span><span class="p">(</span><span class="n">vertices_tags</span><span class="o">=</span><span class="n">initial_point_tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;* 2. get the center of mass of the vertices&quot;</span><span class="p">)</span>
        <span class="n">center_of_mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center_of_mass</span><span class="p">(</span><span class="n">vertices_coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;* 3. create the vertices of the squares&quot;</span><span class="p">)</span>
        <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">subs</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">MAX_SUBDIVISIONS</span><span class="p">):</span>
            <span class="n">square</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_subvertices</span><span class="p">(</span><span class="n">center_of_mass</span><span class="p">,</span> <span class="n">subs</span><span class="p">,</span> <span class="n">SQUARE_SIZE_0_MM</span><span class="p">)</span>
            <span class="n">vertices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">vertices</span><span class="p">,</span> <span class="n">square</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHOW_PLOT</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_vertices</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;* 4. sort the vertices in a grid&quot;</span><span class="p">)</span>
        <span class="n">vertices_sorted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vertices_grid_cleanup</span><span class="p">(</span><span class="n">vertices</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SHOW_PLOT</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_vertices</span><span class="p">(</span><span class="n">vertices_sorted</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;* 5. Calculate transformation matrix&quot;</span><span class="p">)</span>
        <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_affine_transformation_matrix</span><span class="p">(</span><span class="n">vertices_coords</span><span class="p">,</span> <span class="n">vertices_sorted</span><span class="p">)</span>
        <span class="n">transformed_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_transformation_matrix</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">vertices_sorted</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;* 6. Create GMSH points&quot;</span><span class="p">)</span>
        <span class="n">point_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsh_add_points</span><span class="p">(</span><span class="n">transformed_coords</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;* 7. Create GMSH lines&quot;</span><span class="p">)</span>
        <span class="n">line_tags</span><span class="p">,</span> <span class="n">outer_square_lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsh_add_custom_lines</span><span class="p">(</span><span class="n">point_tags</span><span class="p">)</span>

        <span class="c1"># make transfinite lines</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getEntities</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setTransfiniteCurve</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;* 8. Create GMSH surfaces&quot;</span><span class="p">)</span>
        <span class="c1"># create curve loops based on the outer square lines</span>
        <span class="n">surf_tags</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsh_add_surfs</span><span class="p">(</span><span class="n">line_tags</span><span class="p">)</span>
        <span class="n">outer_surfs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">close_outer_loop</span><span class="p">(</span><span class="n">line_tags</span><span class="p">,</span> <span class="n">outer_square_lines</span><span class="p">)</span>

        <span class="n">point_tags</span> <span class="o">=</span> <span class="n">initial_point_tags</span> <span class="o">+</span> <span class="n">point_tags</span>
        <span class="n">line_tags</span> <span class="o">=</span> <span class="n">line_tags</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">outer_square_lines</span><span class="p">])</span>
        <span class="n">surf_tags</span> <span class="o">=</span> <span class="n">surf_tags</span> <span class="o">+</span> <span class="n">outer_surfs</span>

        <span class="k">return</span> <span class="p">(</span>
            <span class="n">point_tags</span><span class="p">,</span>
            <span class="n">line_tags</span><span class="p">,</span>
            <span class="n">surf_tags</span><span class="p">,</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="QuadRefinement.get_adjacent_points">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.get_adjacent_points">[docs]</a>
    <span class="k">def</span> <span class="nf">get_adjacent_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surf_tag</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get adjacent points for a given surface tag.</span>

<span class="sd">        This function retrieves the adjacent points for the specified surface tag.</span>

<span class="sd">        Args:</span>
<span class="sd">            surf_tag (str): The surface tag.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[int]: List of adjacent point tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">adjacecies_down</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getAdjacencies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIM</span><span class="p">,</span> <span class="n">surf_tag</span><span class="p">)</span>
        <span class="n">adj_points</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">adjacecies_down</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">pt_tags_adj_down</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getAdjacencies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DIM</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="n">adj_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pt_tags_adj_down</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">adj_points</span></div>


<div class="viewcode-block" id="QuadRefinement.flatten">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.flatten">[docs]</a>
    <span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Flatten a nested list.</span>

<span class="sd">        This function flattens a nested list into a single list.</span>

<span class="sd">        Args:</span>
<span class="sd">            arr (List[List[Any]]): The nested list.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[Any]: The flattened list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">arr</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span></div>


<div class="viewcode-block" id="QuadRefinement.common">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.common">[docs]</a>
    <span class="k">def</span> <span class="nf">common</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find common elements in an array.</span>

<span class="sd">        This function finds the common elements in the provided array.</span>

<span class="sd">        Args:</span>
<span class="sd">            arr (ndarray): The input array.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray: Array of common elements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">u</span><span class="p">[</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="QuadRefinement.get_common_lines">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.get_common_lines">[docs]</a>
    <span class="k">def</span> <span class="nf">get_common_lines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arr</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get common lines from an array of points.</span>

<span class="sd">        This function retrieves the common lines from the provided array of points.</span>

<span class="sd">        Args:</span>
<span class="sd">            arr (List[int]): List of point tags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ndarray: Array of common line tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
            <span class="n">adj_up</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getAdjacencies</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">adj_up</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;point </span><span class="si">{</span><span class="n">point</span><span class="si">}</span><span class="s2"> has adj lines </span><span class="si">{</span><span class="n">adj_up</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines_flatten</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flatten</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
        <span class="n">lines_common</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">common</span><span class="p">(</span><span class="n">lines_flatten</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lines_common</span></div>


<div class="viewcode-block" id="QuadRefinement.create_intersurface_connection">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.create_intersurface_connection">[docs]</a>
    <span class="k">def</span> <span class="nf">create_intersurface_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point_tags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create intersurface connections.</span>

<span class="sd">        This function creates intersurface connections based on the provided point tags.</span>

<span class="sd">        Args:</span>
<span class="sd">            point_tags (List[List[int]]): List of point tags for each surface.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[List[int]]: List of line tags for intersurface connections.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">line_tags_intersurf</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">point_tags</span><span class="p">)):</span>
            <span class="n">start_stop</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">point_tags</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">point_tags</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">start_point_0</span> <span class="o">=</span> <span class="n">point_tags</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="n">end_point_0</span> <span class="o">=</span> <span class="n">point_tags</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">point_tags</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]):</span>
                        <span class="n">start_point_1</span> <span class="o">=</span> <span class="n">point_tags</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># point_tags[i][j][0]</span>
                        <span class="n">end_point_1</span> <span class="o">=</span> <span class="n">point_tags</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># point_tags[i][j][0]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">start_point_1</span> <span class="o">=</span> <span class="n">point_tags</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>
                        <span class="n">end_point_1</span> <span class="o">=</span> <span class="n">point_tags</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="n">m</span><span class="p">]</span>
                    <span class="n">start_stop</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">[</span>
                            <span class="n">start_point_0</span><span class="p">,</span>
                            <span class="n">end_point_0</span><span class="p">,</span>
                            <span class="n">start_point_1</span><span class="p">,</span>
                            <span class="n">end_point_1</span><span class="p">,</span>
                        <span class="p">]</span>
                    <span class="p">)</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">start_stop</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="n">points_0</span> <span class="o">=</span> <span class="n">st</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">idx_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">points_0</span><span class="p">,</span> <span class="n">return_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">unique_st</span> <span class="o">=</span> <span class="n">st</span><span class="p">[</span><span class="n">idx_0</span><span class="p">]</span>

            <span class="n">line_tags_intersurf_a</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">point</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_st</span><span class="p">):</span>
                <span class="n">_line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">line_tags_intersurf_a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_line</span><span class="p">)</span>
            <span class="n">line_tags_intersurf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_tags_intersurf_a</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">line_tags_intersurf</span></div>


<div class="viewcode-block" id="QuadRefinement.create_line_dict">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.create_line_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">create_line_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lines_lower_surf</span><span class="p">,</span> <span class="n">lines_upper_surf</span><span class="p">,</span> <span class="n">lines_intersurf</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create dictionaries of lines and their corresponding points.</span>

<span class="sd">        This function creates dictionaries for the lower surface lines, upper surface lines, and intersurface lines,</span>
<span class="sd">        mapping each line to its corresponding points.</span>

<span class="sd">        Args:</span>
<span class="sd">            lines_lower_surf (List[List[int]]): List of line tags for the lower surface.</span>
<span class="sd">            lines_upper_surf (List[List[int]]): List of line tags for the upper surface.</span>
<span class="sd">            lines_intersurf (List[int]): List of line tags for the intersurface.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[Dict[int, List[int]], Dict[int, List[int]], Dict[int, List[int]]]:</span>
<span class="sd">                - Dictionary of lower surface lines and their points.</span>
<span class="sd">                - Dictionary of upper surface lines and their points.</span>
<span class="sd">                - Dictionary of intersurface lines and their points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Step 1: Create a dictionary of all lines and their corresponding points</span>
        <span class="n">lines_lower_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">lines_upper_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">lines_intersurf_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="n">lines_lower_surf</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">line_points</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getAdjacencies</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="n">lines_lower_dict</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_points</span>
        <span class="k">for</span> <span class="n">subset</span> <span class="ow">in</span> <span class="n">lines_upper_surf</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">subset</span><span class="p">:</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">line_points</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getAdjacencies</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
                <span class="n">lines_upper_dict</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_points</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines_intersurf</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">line_points</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getAdjacencies</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
            <span class="n">lines_intersurf_dict</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">line_points</span>
        <span class="k">return</span> <span class="n">lines_lower_dict</span><span class="p">,</span> <span class="n">lines_upper_dict</span><span class="p">,</span> <span class="n">lines_intersurf_dict</span></div>


<div class="viewcode-block" id="QuadRefinement.create_surf_dict">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.create_surf_dict">[docs]</a>
    <span class="k">def</span> <span class="nf">create_surf_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surf_lower</span><span class="p">,</span> <span class="n">surf_upper</span><span class="p">,</span> <span class="n">surf_inter</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create dictionaries of surfaces and their corresponding lines.</span>

<span class="sd">        This function creates dictionaries for the lower surfaces, upper surfaces, and intersurfaces,</span>
<span class="sd">        mapping each surface to its corresponding lines.</span>

<span class="sd">        Args:</span>
<span class="sd">            surf_lower (List[int]): List of surface tags for the lower surface.</span>
<span class="sd">            surf_upper (List[int]): List of surface tags for the upper surface.</span>
<span class="sd">            surf_inter (List[int]): List of surface tags for the intersurface.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[Dict[int, List[int]], Dict[int, List[int]], Dict[int, List[int]]]:</span>
<span class="sd">                - Dictionary of lower surfaces and their lines.</span>
<span class="sd">                - Dictionary of upper surfaces and their lines.</span>
<span class="sd">                - Dictionary of intersurfaces and their lines.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">surf_lower_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">surf_upper_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">surf_inter_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">surf</span> <span class="ow">in</span> <span class="n">surf_lower</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">surf_lines</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getAdjacencies</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">surf</span><span class="p">)</span>
            <span class="n">surf_lower_dict</span><span class="p">[</span><span class="n">surf</span><span class="p">]</span> <span class="o">=</span> <span class="n">surf_lines</span>
        <span class="k">for</span> <span class="n">surf</span> <span class="ow">in</span> <span class="n">surf_upper</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">surf_lines</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getAdjacencies</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">surf</span><span class="p">)</span>
            <span class="n">surf_upper_dict</span><span class="p">[</span><span class="n">surf</span><span class="p">]</span> <span class="o">=</span> <span class="n">surf_lines</span>
        <span class="k">for</span> <span class="n">surf</span> <span class="ow">in</span> <span class="n">surf_inter</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">surf_lines</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getAdjacencies</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">surf</span><span class="p">)</span>
            <span class="n">surf_inter_dict</span><span class="p">[</span><span class="n">surf</span><span class="p">]</span> <span class="o">=</span> <span class="n">surf_lines</span>
        <span class="k">return</span> <span class="n">surf_lower_dict</span><span class="p">,</span> <span class="n">surf_upper_dict</span><span class="p">,</span> <span class="n">surf_inter_dict</span></div>


<div class="viewcode-block" id="QuadRefinement.check_closed_surface_loop">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.check_closed_surface_loop">[docs]</a>
    <span class="k">def</span> <span class="nf">check_closed_surface_loop</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">lines_lower_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">lines_upper_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">lines_intersurf_dict</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check for closed surface loops.</span>

<span class="sd">        This function checks for closed surface loops by matching lines from the lower surface, upper surface,</span>
<span class="sd">        and intersurface dictionaries.</span>

<span class="sd">        Args:</span>
<span class="sd">            lines_lower_dict (Dict[int, List[int]]): Dictionary of lower surface lines and their points.</span>
<span class="sd">            lines_upper_dict (Dict[int, List[int]]): Dictionary of upper surface lines and their points.</span>
<span class="sd">            lines_intersurf_dict (Dict[int, List[int]]): Dictionary of intersurface lines and their points.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[int, List[int]]: Dictionary of closed surface loops.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">surf_loop_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">index</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">key1</span><span class="p">,</span> <span class="n">value1</span> <span class="ow">in</span> <span class="n">lines_lower_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">key_pairs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key2</span><span class="p">,</span> <span class="n">value2</span> <span class="ow">in</span> <span class="n">lines_intersurf_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">item</span> <span class="ow">in</span> <span class="n">value2</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value1</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found a matching value in </span><span class="si">{</span><span class="n">key1</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">key2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">key_pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key2</span><span class="p">)</span>
            <span class="n">surf_loop</span> <span class="o">=</span> <span class="p">[</span><span class="n">key1</span><span class="p">]</span> <span class="o">+</span> <span class="n">key_pairs</span>

            <span class="n">surf_loop_dict</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">surf_loop</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c1"># every line in surf_loop_dict should be contained in 4 surfaces made from lines_intersurf_dict --&gt; check the combinations</span>
        <span class="k">for</span> <span class="n">key3</span><span class="p">,</span> <span class="n">value3</span> <span class="ow">in</span> <span class="n">lines_upper_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">key_pairs_2</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key2</span><span class="p">,</span> <span class="n">value2</span> <span class="ow">in</span> <span class="n">lines_intersurf_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">item</span> <span class="ow">in</span> <span class="n">value2</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value3</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found a matching value in </span><span class="si">{</span><span class="n">key3</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">key2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">key_pairs_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key2</span><span class="p">)</span>

            <span class="c1"># check if all values in key_pairs_two are in item, if yes, append key3 to surf_loop_dict</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">surf_loop_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">key_pair</span> <span class="ow">in</span> <span class="n">item</span> <span class="k">for</span> <span class="n">key_pair</span> <span class="ow">in</span> <span class="n">key_pairs_2</span><span class="p">):</span>
                    <span class="n">item</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key3</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found a matching value: </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">surf_loop_dict</span></div>


<div class="viewcode-block" id="QuadRefinement.add_curve_loop">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.add_curve_loop">[docs]</a>
    <span class="k">def</span> <span class="nf">add_curve_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve_loop_tags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a curve loop to the Gmsh model.</span>

<span class="sd">        This function adds a curve loop to the Gmsh model based on the provided curve loop tags.</span>

<span class="sd">        Args:</span>
<span class="sd">            curve_loop_tags (List[int]): List of curve loop tags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The tag of the created curve loop.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">(</span><span class="n">curve_loop_tags</span><span class="p">,</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="QuadRefinement.gmsh_add_surface">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.gmsh_add_surface">[docs]</a>
    <span class="k">def</span> <span class="nf">gmsh_add_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curve_loop</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a surface to the Gmsh model.</span>

<span class="sd">        This function adds a surface to the Gmsh model based on the provided curve loop.</span>

<span class="sd">        Args:</span>
<span class="sd">            curve_loop (int): The curve loop tag.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The tag of the created surface.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addSurfaceFilling</span><span class="p">(</span><span class="n">curve_loop</span><span class="p">,</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="QuadRefinement.add_surface_loop">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.add_surface_loop">[docs]</a>
    <span class="k">def</span> <span class="nf">add_surface_loop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_loop_tags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a surface loop to the Gmsh model.</span>

<span class="sd">        This function adds a surface loop to the Gmsh model based on the provided surface loop tags.</span>

<span class="sd">        Args:</span>
<span class="sd">            surface_loop_tags (List[int]): List of surface loop tags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The tag of the created surface loop.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addSurfaceLoop</span><span class="p">(</span><span class="n">surface_loop_tags</span><span class="p">,</span> <span class="n">sewing</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="QuadRefinement.gmsh_add_volume">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.gmsh_add_volume">[docs]</a>
    <span class="k">def</span> <span class="nf">gmsh_add_volume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">surface_loop</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Add a volume to the Gmsh model.</span>

<span class="sd">        This function adds a volume to the Gmsh model based on the provided surface loop.</span>

<span class="sd">        Args:</span>
<span class="sd">            surface_loop (int): The surface loop tag.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The tag of the created volume.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addVolume</span><span class="p">(</span><span class="n">surface_loop</span><span class="p">,</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></div>


<div class="viewcode-block" id="QuadRefinement.exec_quad_refinement">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.QuadRefinement.exec_quad_refinement">[docs]</a>
    <span class="k">def</span> <span class="nf">exec_quad_refinement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outer_point_tags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Execute quadrilateral refinement on the given outer point tags.</span>

<span class="sd">        This function performs quadrilateral refinement on the provided outer point tags, creating points, lines,</span>
<span class="sd">        surfaces, and volumes in the Gmsh model.</span>

<span class="sd">        Args:</span>
<span class="sd">            outer_point_tags (List[List[int]]): List of lists of point tags, each representing a corner of the structure.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[List[List[int]], List[List[int]], List[List[int]]]:</span>
<span class="sd">                - List of line tags for intersurface connections.</span>
<span class="sd">                - List of surface tags.</span>
<span class="sd">                - List of volume tags.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">point_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">line_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">surf_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">surf_loops</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">initial_point_tags</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">outer_point_tags</span><span class="p">):</span>
            <span class="p">(</span>
                <span class="n">trab_refinement_point_tags</span><span class="p">,</span>
                <span class="n">trab_refinement_line_tags</span><span class="p">,</span>
                <span class="n">trab_refinement_surf_tags</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">quad_refinement</span><span class="p">(</span><span class="n">initial_point_tags</span><span class="p">)</span>

            <span class="n">point_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trab_refinement_point_tags</span><span class="p">)</span>
            <span class="n">line_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trab_refinement_line_tags</span><span class="p">)</span>
            <span class="n">surf_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">trab_refinement_surf_tags</span><span class="p">)</span>

        <span class="c1"># add missing line at the end of the surface</span>
        <span class="n">intersurf_line_last_line</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">point_tags</span><span class="p">)):</span>
            <span class="n">ll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">point_tags</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">point_tags</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">intersurf_line_last_line</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ll</span><span class="p">)</span>

        <span class="n">points_in_surf</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">plane_surfs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_slice</span> <span class="ow">in</span> <span class="n">surf_tags</span><span class="p">:</span>
            <span class="n">connected_points</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">surf</span> <span class="ow">in</span> <span class="n">_slice</span><span class="p">:</span>
                <span class="n">pt_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_adjacent_points</span><span class="p">(</span><span class="n">surf</span><span class="p">)</span>
                <span class="n">tag_unique</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">pt_tag</span><span class="p">)</span>
                <span class="n">connected_points</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag_unique</span><span class="p">)</span>
            <span class="n">points_in_surf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">connected_points</span><span class="p">)</span>
            <span class="n">plane_surfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_slice</span><span class="p">)</span>

        <span class="n">line_tags_intersurf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_intersurface_connection</span><span class="p">(</span><span class="n">points_in_surf</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">l_intersurf_subset</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">line_tags_intersurf</span><span class="p">):</span>
            <span class="n">l_intersurf_subset</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">intersurf_line_last_line</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>

        <span class="n">intersurface_surfaces_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">volume_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_iter</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">points_in_surf</span><span class="p">)):</span>
            <span class="p">(</span>
                <span class="n">lines_lower_dict</span><span class="p">,</span>
                <span class="n">lines_upper_dict</span><span class="p">,</span>
                <span class="n">lines_intersurf_dict</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_line_dict</span><span class="p">(</span>
                <span class="n">lines_lower_surf</span><span class="o">=</span><span class="n">line_tags</span><span class="p">[</span><span class="n">_iter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">lines_upper_surf</span><span class="o">=</span><span class="n">line_tags</span><span class="p">[</span><span class="n">_iter</span><span class="p">],</span>
                <span class="n">lines_intersurf</span><span class="o">=</span><span class="n">line_tags_intersurf</span><span class="p">[</span><span class="n">_iter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">curve_loops</span> <span class="o">=</span> <span class="n">fcc</span><span class="o">.</span><span class="n">find_closed_curve_loops</span><span class="p">(</span>
                <span class="n">lines_lower_dict</span><span class="p">,</span> <span class="n">lines_upper_dict</span><span class="p">,</span> <span class="n">lines_intersurf_dict</span>
            <span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">exec_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Time to find closed curve loops: </span><span class="si">{</span><span class="n">exec_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>

            <span class="n">intersurface_surfaces_slice</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">cl</span> <span class="ow">in</span> <span class="n">curve_loops</span><span class="p">:</span>
                <span class="n">curve_loop_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_curve_loop</span><span class="p">(</span><span class="n">cl</span><span class="p">)</span>
                <span class="n">surf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsh_add_surface</span><span class="p">(</span><span class="n">curve_loop_tag</span><span class="p">)</span>
                <span class="n">intersurface_surfaces_slice</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surf</span><span class="p">)</span>
            <span class="n">intersurface_surfaces_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intersurface_surfaces_slice</span><span class="p">)</span>

            <span class="c1"># * ADDING SURFACE LOOPS AND INTERSURFACE VOLUMES</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
            <span class="p">(</span>
                <span class="n">surf_lower_dict</span><span class="p">,</span>
                <span class="n">surf_upper_dict</span><span class="p">,</span>
                <span class="n">surf_inter_dict</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_surf_dict</span><span class="p">(</span>
                <span class="n">plane_surfs</span><span class="p">[</span><span class="n">_iter</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">plane_surfs</span><span class="p">[</span><span class="n">_iter</span><span class="p">],</span>
                <span class="n">intersurface_surfaces_slice</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">surf_lower_dict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">surf_upper_dict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">surf_inter_dict</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;-----------------&quot;</span><span class="p">)</span>

            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">surf_loops_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_closed_surface_loop</span><span class="p">(</span>
                <span class="n">surf_lower_dict</span><span class="p">,</span> <span class="n">surf_upper_dict</span><span class="p">,</span> <span class="n">surf_inter_dict</span>
            <span class="p">)</span>
            <span class="n">surf_loops</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">surf_loops_slice</span><span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Time to check closed surface loops: </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span>
            <span class="p">)</span>

        <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="n">intersurface_volume_tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">surf_slice</span> <span class="ow">in</span> <span class="n">surf_loops</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_surf_values</span> <span class="ow">in</span> <span class="n">surf_slice</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">surf_loop_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_surface_loop</span><span class="p">(</span><span class="n">_surf_values</span><span class="p">)</span>
                <span class="n">vol_tag</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gmsh_add_volume</span><span class="p">([</span><span class="n">surf_loop_tag</span><span class="p">])</span>
                <span class="n">intersurface_volume_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vol_tag</span><span class="p">)</span>
            <span class="n">volume_tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">intersurface_volume_tags</span><span class="p">)</span>

        <span class="c1"># # TODO: move to upper scope when testing is done</span>
        <span class="n">surfs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">chain</span><span class="p">(</span><span class="n">surf_tags</span><span class="p">,</span> <span class="n">intersurface_surfaces_tags</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">line_subset</span> <span class="ow">in</span> <span class="n">line_tags_intersurf</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">line_subset</span><span class="p">:</span>
                <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setTransfiniteCurve</span><span class="p">(</span>
                    <span class="n">line</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">elms_thickness</span><span class="p">,</span> <span class="s2">&quot;Progression&quot;</span><span class="p">,</span> <span class="mf">1.0</span>
                <span class="p">)</span>
        <span class="k">for</span> <span class="n">surf_subset</span> <span class="ow">in</span> <span class="n">surfs</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">surf</span> <span class="ow">in</span> <span class="n">surf_subset</span><span class="p">:</span>
                <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setTransfiniteSurface</span><span class="p">(</span><span class="n">surf</span><span class="p">)</span>
                <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setRecombine</span><span class="p">(</span><span class="n">surf</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">intersurf_vols</span> <span class="ow">in</span> <span class="n">volume_tags</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">vol</span> <span class="ow">in</span> <span class="n">intersurf_vols</span><span class="p">:</span>
                <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">setTransfiniteVolume</span><span class="p">(</span><span class="n">vol</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">line_tags_intersurf</span><span class="p">,</span> <span class="n">surfs</span><span class="p">,</span> <span class="n">volume_tags</span></div>
</div>



<div class="viewcode-block" id="create_initial_points">
<a class="viewcode-back" href="../quad_refinement.html#quad_refinement.create_initial_points">[docs]</a>
<span class="k">def</span> <span class="nf">create_initial_points</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add point in the Gmsh model.</span>

<span class="sd">    This function adds a point to the Gmsh model based on the provided coordinates.</span>

<span class="sd">    Args:</span>
<span class="sd">        coords (Tuple[float, float, float]): The coordinates of the point.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: The tag of the created point.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">occ</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="o">*</span><span class="n">coords</span><span class="p">,</span> <span class="n">tag</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Simone Poncioni.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>